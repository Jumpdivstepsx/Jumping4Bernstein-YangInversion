#include "macros_neon.h"
#include "polymul_neon.h"
#include <arm_neon.h>

//(x^8-1) = twiddle permute butterfly
int16x8_t twiddle_p_768 = {
    72,    -3430,     3219,     3590,      363,     2020,      591,    -1835
};
//(x^8+1)
int16x8_t twiddle_n_768 = {
    2232,     -864,     681,     -788,    -2047,     1336,      -19,    -2325
};
//(x^8-1)
int16x8_t itwiddle_p_768 = {
    -1837,      589,     2018,     361,     3588,     3217,    -3432,       70
};
//(x^8+1)
int16x8_t itwiddle_n_768 = {
    -2325,      -19,     1336,    -2047,     -788,      681,     -864,     2232
};

//twist_table: 0-95; nR_overq2: 96-191
int16x8_t twist768[192] = {
    {4051, 2996, 2898, 143, 975, 1222, 1654, 2930}, {2448, 4170, 3390, 576, 171, 2418, 2296, 3551}, {839, 4051, 2996, 2898, 143, 975, 1222, 1654}, {2930, 2448, 4170, 3390, 576, 171, 2418, 2296}, {3551, 839, 4051, 2996, 2898, 143, 975, 1222}, {1654, 2930, 2448, 4170, 3390, 576, 171, 2418}, {143, 1222, 2930, 4170, 576, 2418, 3551, 4051}, {2898, 975, 1654, 2448, 3390, 171, 2296, 839}, {2996, 143, 1222, 2930, 4170, 576, 2418, 3551}, {4051, 2898, 975, 1654, 2448, 3390, 171, 2296}, {839, 2996, 143, 1222, 2930, 4170, 576, 2418}, {3551, 4051, 2898, 975, 1654, 2448, 3390, 171}, {1654, 4170, 171, 3551, 2996, 975, 2930, 3390}, {2418, 839, 2898, 1222, 2448, 576, 2296, 4051}, {143, 1654, 4170, 171, 3551, 2996, 975, 2930}, {3390, 2418, 839, 2898, 1222, 2448, 576, 2296}, {4051, 143, 1654, 4170, 171, 3551, 2996, 975}, {2930, 3390, 2418, 839, 2898, 1222, 2448, 576}, {4170, 2418, 4051, 975, 2448, 171, 839, 143}, {2930, 576, 3551, 2898, 1654, 3390, 2296, 2996}, {1222, 4170, 2418, 4051, 975, 2448, 171, 839}, {143, 2930, 576, 3551, 2898, 1654, 3390, 2296}, {2996, 1222, 4170, 2418, 4051, 975, 2448, 171}, {839, 143, 2930, 576, 3551, 2898, 1654, 3390}, {171, 4051, 1222, 3390, 3551, 143, 2448, 2418}, {2996, 1654, 576, 839, 975, 4170, 2296, 2898}, {2930, 171, 4051, 1222, 3390, 3551, 143, 2448}, {2418, 2996, 1654, 576, 839, 975, 4170, 2296}, {2898, 2930, 171, 4051, 1222, 3390, 3551, 143}, {2448, 2418, 2996, 1654, 576, 839, 975, 4170}, {3551, 975, 3390, 839, 1222, 576, 4051, 1654}, {171, 2996, 2930, 2418, 2898, 2448, 2296, 143}, {4170, 3551, 975, 3390, 839, 1222, 576, 4051}, {1654, 171, 2996, 2930, 2418, 2898, 2448, 2296}, {143, 4170, 3551, 975, 3390, 839, 1222, 576}, {4051, 1654, 171, 2996, 2930, 2418, 2898, 2448}, {2996, 2448, 3551, 1222, 171, 2898, 4170, 839}, {1654, 2418, 143, 3390, 4051, 2930, 2296, 975}, {576, 2996, 2448, 3551, 1222, 171, 2898, 4170}, {839, 1654, 2418, 143, 3390, 4051, 2930, 2296}, {975, 576, 2996, 2448, 3551, 1222, 171, 2898}, {4170, 839, 1654, 2418, 143, 3390, 4051, 2930}, {975, 171, 143, 576, 2898, 3390, 2996, 4170}, {4051, 2448, 839, 2930, 3551, 1654, 2296, 1222}, {2418, 975, 171, 143, 576, 2898, 3390, 2996}, {4170, 4051, 2448, 839, 2930, 3551, 1654, 2296}, {1222, 2418, 975, 171, 143, 576, 2898, 3390}, {2996, 4170, 4051, 2448, 839, 2930, 3551, 1654}, {2930, 839, 2448, 4051, 4170, 2996, 3390, 2898}, {576, 143, 171, 975, 2418, 1222, 2296, 1654}, {3551, 2930, 839, 2448, 4051, 4170, 2996, 3390}, {2898, 576, 143, 171, 975, 2418, 1222, 2296}, {1654, 3551, 2930, 839, 2448, 4051, 4170, 2996}, {3390, 2898, 576, 143, 171, 975, 2418, 1222}, {3390, 143, 2418, 1654, 839, 4170, 2898, 171}, {1222, 3551, 2448, 2996, 576, 975, 2296, 2930}, {4051, 3390, 143, 2418, 1654, 839, 4170, 2898}, {171, 1222, 3551, 2448, 2996, 576, 975, 2296}, {2930, 4051, 3390, 143, 2418, 1654, 839, 4170}, {2898, 171, 1222, 3551, 2448, 2996, 576, 975}, {2418, 2930, 2996, 171, 1654, 4051, 576, 1222}, {839, 3390, 975, 3551, 4170, 143, 2296, 2448}, {2898, 2418, 2930, 2996, 171, 1654, 4051, 576}, {1222, 839, 3390, 975, 3551, 4170, 143, 2296}, {2448, 2898, 2418, 2930, 2996, 171, 1654, 4051}, {576, 1222, 839, 3390, 975, 3551, 4170, 143}, {839, 576, 1654, 2996, 2418, 2448, 143, 3551}, {3390, 1222, 4051, 171, 2930, 2898, 2296, 4170}, {975, 839, 576, 1654, 2996, 2418, 2448, 143}, {3551, 3390, 1222, 4051, 171, 2930, 2898, 2296}, {4170, 975, 839, 576, 1654, 2996, 2418, 2448}, {143, 3551, 3390, 1222, 4051, 171, 2930, 2898}, {2898, 3551, 576, 2930, 143, 839, 171, 2448}, {975, 4051, 2418, 4170, 1222, 2996, 2296, 3390}, {1654, 2898, 3551, 576, 2930, 143, 839, 171}, {2448, 975, 4051, 2418, 4170, 1222, 2996, 2296}, {3390, 1654, 2898, 3551, 576, 2930, 143, 839}, {171, 2448, 975, 4051, 2418, 4170, 1222, 2996}, {1222, 2898, 839, 2418, 3390, 2930, 975, 2996}, {3551, 171, 4170, 1654, 143, 4051, 2296, 576}, {2448, 1222, 2898, 839, 2418, 3390, 2930, 975}, {2996, 3551, 171, 4170, 1654, 143, 4051, 2296}, {576, 2448, 1222, 2898, 839, 2418, 3390, 2930}, {975, 2996, 3551, 171, 4170, 1654, 143, 4051}, {2448, 1654, 975, 2898, 4051, 3551, 2418, 576}, {4170, 2930, 1222, 143, 2996, 839, 2296, 171}, {3390, 2448, 1654, 975, 2898, 4051, 3551, 2418}, {576, 4170, 2930, 1222, 143, 2996, 839, 2296}, {171, 3390, 2448, 1654, 975, 2898, 4051, 3551}, {2418, 576, 4170, 2930, 1222, 143, 2996, 839}, {576, 3390, 4170, 2448, 2930, 1654, 1222, 975}, {143, 2898, 2996, 4051, 839, 3551, 2296, 2418}, {171, 576, 3390, 4170, 2448, 2930, 1654, 1222}, {975, 143, 2898, 2996, 4051, 839, 3551, 2296}, {2418, 171, 576, 3390, 4170, 2448, 2930, 1654}, {1222, 975, 143, 2898, 2996, 4051, 839, 3551}, {28914, 21384, 20684, 1021, 6959, 8722, 11805, 20913}, {17472, 29763, 24196, 4111, 1221, 17258, 16388, 25345}, {5988, 28914, 21384, 20684, 1021, 6959, 8722, 11805}, {20913, 17472, 29763, 24196, 4111, 1221, 17258, 16388}, {25345, 5988, 28914, 21384, 20684, 1021, 6959, 8722}, {11805, 20913, 17472, 29763, 24196, 4111, 1221, 17258}, {1021, 8722, 20913, 29763, 4111, 17258, 25345, 28914}, {20684, 6959, 11805, 17472, 24196, 1221, 16388, 5988}, {21384, 1021, 8722, 20913, 29763, 4111, 17258, 25345}, {28914, 20684, 6959, 11805, 17472, 24196, 1221, 16388}, {5988, 21384, 1021, 8722, 20913, 29763, 4111, 17258}, {25345, 28914, 20684, 6959, 11805, 17472, 24196, 1221}, {11805, 29763, 1221, 25345, 21384, 6959, 20913, 24196}, {17258, 5988, 20684, 8722, 17472, 4111, 16388, 28914}, {1021, 11805, 29763, 1221, 25345, 21384, 6959, 20913}, {24196, 17258, 5988, 20684, 8722, 17472, 4111, 16388}, {28914, 1021, 11805, 29763, 1221, 25345, 21384, 6959}, {20913, 24196, 17258, 5988, 20684, 8722, 17472, 4111}, {29763, 17258, 28914, 6959, 17472, 1221, 5988, 1021}, {20913, 4111, 25345, 20684, 11805, 24196, 16388, 21384}, {8722, 29763, 17258, 28914, 6959, 17472, 1221, 5988}, {1021, 20913, 4111, 25345, 20684, 11805, 24196, 16388}, {21384, 8722, 29763, 17258, 28914, 6959, 17472, 1221}, {5988, 1021, 20913, 4111, 25345, 20684, 11805, 24196}, {1221, 28914, 8722, 24196, 25345, 1021, 17472, 17258}, {21384, 11805, 4111, 5988, 6959, 29763, 16388, 20684}, {20913, 1221, 28914, 8722, 24196, 25345, 1021, 17472}, {17258, 21384, 11805, 4111, 5988, 6959, 29763, 16388}, {20684, 20913, 1221, 28914, 8722, 24196, 25345, 1021}, {17472, 17258, 21384, 11805, 4111, 5988, 6959, 29763}, {25345, 6959, 24196, 5988, 8722, 4111, 28914, 11805}, {1221, 21384, 20913, 17258, 20684, 17472, 16388, 1021}, {29763, 25345, 6959, 24196, 5988, 8722, 4111, 28914}, {11805, 1221, 21384, 20913, 17258, 20684, 17472, 16388}, {1021, 29763, 25345, 6959, 24196, 5988, 8722, 4111}, {28914, 11805, 1221, 21384, 20913, 17258, 20684, 17472}, {21384, 17472, 25345, 8722, 1221, 20684, 29763, 5988}, {11805, 17258, 1021, 24196, 28914, 20913, 16388, 6959}, {4111, 21384, 17472, 25345, 8722, 1221, 20684, 29763}, {5988, 11805, 17258, 1021, 24196, 28914, 20913, 16388}, {6959, 4111, 21384, 17472, 25345, 8722, 1221, 20684}, {29763, 5988, 11805, 17258, 1021, 24196, 28914, 20913}, {6959, 1221, 1021, 4111, 20684, 24196, 21384, 29763}, {28914, 17472, 5988, 20913, 25345, 11805, 16388, 8722}, {17258, 6959, 1221, 1021, 4111, 20684, 24196, 21384}, {29763, 28914, 17472, 5988, 20913, 25345, 11805, 16388}, {8722, 17258, 6959, 1221, 1021, 4111, 20684, 24196}, {21384, 29763, 28914, 17472, 5988, 20913, 25345, 11805}, {20913, 5988, 17472, 28914, 29763, 21384, 24196, 20684}, {4111, 1021, 1221, 6959, 17258, 8722, 16388, 11805}, {25345, 20913, 5988, 17472, 28914, 29763, 21384, 24196}, {20684, 4111, 1021, 1221, 6959, 17258, 8722, 16388}, {11805, 25345, 20913, 5988, 17472, 28914, 29763, 21384}, {24196, 20684, 4111, 1021, 1221, 6959, 17258, 8722}, {24196, 1021, 17258, 11805, 5988, 29763, 20684, 1221}, {8722, 25345, 17472, 21384, 4111, 6959, 16388, 20913}, {28914, 24196, 1021, 17258, 11805, 5988, 29763, 20684}, {1221, 8722, 25345, 17472, 21384, 4111, 6959, 16388}, {20913, 28914, 24196, 1021, 17258, 11805, 5988, 29763}, {20684, 1221, 8722, 25345, 17472, 21384, 4111, 6959}, {17258, 20913, 21384, 1221, 11805, 28914, 4111, 8722}, {5988, 24196, 6959, 25345, 29763, 1021, 16388, 17472}, {20684, 17258, 20913, 21384, 1221, 11805, 28914, 4111}, {8722, 5988, 24196, 6959, 25345, 29763, 1021, 16388}, {17472, 20684, 17258, 20913, 21384, 1221, 11805, 28914}, {4111, 8722, 5988, 24196, 6959, 25345, 29763, 1021}, {5988, 4111, 11805, 21384, 17258, 17472, 1021, 25345}, {24196, 8722, 28914, 1221, 20913, 20684, 16388, 29763}, {6959, 5988, 4111, 11805, 21384, 17258, 17472, 1021}, {25345, 24196, 8722, 28914, 1221, 20913, 20684, 16388}, {29763, 6959, 5988, 4111, 11805, 21384, 17258, 17472}, {1021, 25345, 24196, 8722, 28914, 1221, 20913, 20684}, {20684, 25345, 4111, 20913, 1021, 5988, 1221, 17472}, {6959, 28914, 17258, 29763, 8722, 21384, 16388, 24196}, {11805, 20684, 25345, 4111, 20913, 1021, 5988, 1221}, {17472, 6959, 28914, 17258, 29763, 8722, 21384, 16388}, {24196, 11805, 20684, 25345, 4111, 20913, 1021, 5988}, {1221, 17472, 6959, 28914, 17258, 29763, 8722, 21384}, {8722, 20684, 5988, 17258, 24196, 20913, 6959, 21384}, {25345, 1221, 29763, 11805, 1021, 28914, 16388, 4111}, {17472, 8722, 20684, 5988, 17258, 24196, 20913, 6959}, {21384, 25345, 1221, 29763, 11805, 1021, 28914, 16388}, {4111, 17472, 8722, 20684, 5988, 17258, 24196, 20913}, {6959, 21384, 25345, 1221, 29763, 11805, 1021, 28914}, {17472, 11805, 6959, 20684, 28914, 25345, 17258, 4111}, {29763, 20913, 8722, 1021, 21384, 5988, 16388, 1221}, {24196, 17472, 11805, 6959, 20684, 28914, 25345, 17258}, {4111, 29763, 20913, 8722, 1021, 21384, 5988, 16388}, {1221, 24196, 17472, 11805, 6959, 20684, 28914, 25345}, {17258, 4111, 29763, 20913, 8722, 1021, 21384, 5988}, {4111, 24196, 29763, 17472, 20913, 11805, 8722, 6959}, {1021, 20684, 21384, 28914, 5988, 25345, 16388, 17258}, {1221, 4111, 24196, 29763, 17472, 20913, 11805, 8722}, {6959, 1021, 20684, 21384, 28914, 5988, 25345, 16388}, {17258, 1221, 4111, 24196, 29763, 17472, 20913, 11805}, {8722, 6959, 1021, 20684, 21384, 28914, 5988, 25345}
};

//itwist_table: 0-95; nR_overq2: 96-191
int16x8_t twist768_inv[192] = {
    {287, 1450, 1743, 72, 3867, 1669, 306, 1514}, {3650, 3596, 4139, 4035, 1510, 2670, 2228, 4122}, {4461, 287, 1450, 1743, 72, 3867, 1669, 306}, {1514, 3650, 3596, 4139, 4035, 1510, 2670, 2228}, {4122, 4461, 287, 1450, 1743, 72, 3867, 1669}, {306, 1514, 3650, 3596, 4139, 4035, 1510, 2670}, {72, 1669, 1514, 3596, 4035, 2670, 4122, 287}, {1743, 3867, 306, 3650, 4139, 1510, 2228, 4461}, {1450, 72, 1669, 1514, 3596, 4035, 2670, 4122}, {287, 1743, 3867, 306, 3650, 4139, 1510, 2228}, {4461, 1450, 72, 1669, 1514, 3596, 4035, 2670}, {4122, 287, 1743, 3867, 306, 3650, 4139, 1510}, {306, 3596, 1510, 4122, 1450, 3867, 1514, 4139}, {2670, 4461, 1743, 1669, 3650, 4035, 2228, 287}, {72, 306, 3596, 1510, 4122, 1450, 3867, 1514}, {4139, 2670, 4461, 1743, 1669, 3650, 4035, 2228}, {287, 72, 306, 3596, 1510, 4122, 1450, 3867}, {1514, 4139, 2670, 4461, 1743, 1669, 3650, 4035}, {3596, 2670, 287, 3867, 3650, 1510, 4461, 72}, {1514, 4035, 4122, 1743, 306, 4139, 2228, 1450}, {1669, 3596, 2670, 287, 3867, 3650, 1510, 4461}, {72, 1514, 4035, 4122, 1743, 306, 4139, 2228}, {1450, 1669, 3596, 2670, 287, 3867, 3650, 1510}, {4461, 72, 1514, 4035, 4122, 1743, 306, 4139}, {1510, 287, 1669, 4139, 4122, 72, 3650, 2670}, {1450, 306, 4035, 4461, 3867, 3596, 2228, 1743}, {1514, 1510, 287, 1669, 4139, 4122, 72, 3650}, {2670, 1450, 306, 4035, 4461, 3867, 3596, 2228}, {1743, 1514, 1510, 287, 1669, 4139, 4122, 72}, {3650, 2670, 1450, 306, 4035, 4461, 3867, 3596}, {4122, 3867, 4139, 4461, 1669, 4035, 287, 306}, {1510, 1450, 1514, 2670, 1743, 3650, 2228, 72}, {3596, 4122, 3867, 4139, 4461, 1669, 4035, 287}, {306, 1510, 1450, 1514, 2670, 1743, 3650, 2228}, {72, 3596, 4122, 3867, 4139, 4461, 1669, 4035}, {287, 306, 1510, 1450, 1514, 2670, 1743, 3650}, {1450, 3650, 4122, 1669, 1510, 1743, 3596, 4461}, {306, 2670, 72, 4139, 287, 1514, 2228, 3867}, {4035, 1450, 3650, 4122, 1669, 1510, 1743, 3596}, {4461, 306, 2670, 72, 4139, 287, 1514, 2228}, {3867, 4035, 1450, 3650, 4122, 1669, 1510, 1743}, {3596, 4461, 306, 2670, 72, 4139, 287, 1514}, {3867, 1510, 72, 4035, 1743, 4139, 1450, 3596}, {287, 3650, 4461, 1514, 4122, 306, 2228, 1669}, {2670, 3867, 1510, 72, 4035, 1743, 4139, 1450}, {3596, 287, 3650, 4461, 1514, 4122, 306, 2228}, {1669, 2670, 3867, 1510, 72, 4035, 1743, 4139}, {1450, 3596, 287, 3650, 4461, 1514, 4122, 306}, {1514, 4461, 3650, 287, 3596, 1450, 4139, 1743}, {4035, 72, 1510, 3867, 2670, 1669, 2228, 306}, {4122, 1514, 4461, 3650, 287, 3596, 1450, 4139}, {1743, 4035, 72, 1510, 3867, 2670, 1669, 2228}, {306, 4122, 1514, 4461, 3650, 287, 3596, 1450}, {4139, 1743, 4035, 72, 1510, 3867, 2670, 1669}, {4139, 72, 2670, 306, 4461, 3596, 1743, 1510}, {1669, 4122, 3650, 1450, 4035, 3867, 2228, 1514}, {287, 4139, 72, 2670, 306, 4461, 3596, 1743}, {1510, 1669, 4122, 3650, 1450, 4035, 3867, 2228}, {1514, 287, 4139, 72, 2670, 306, 4461, 3596}, {1743, 1510, 1669, 4122, 3650, 1450, 4035, 3867}, {2670, 1514, 1450, 1510, 306, 287, 4035, 1669}, {4461, 4139, 3867, 4122, 3596, 72, 2228, 3650}, {1743, 2670, 1514, 1450, 1510, 306, 287, 4035}, {1669, 4461, 4139, 3867, 4122, 3596, 72, 2228}, {3650, 1743, 2670, 1514, 1450, 1510, 306, 287}, {4035, 1669, 4461, 4139, 3867, 4122, 3596, 72}, {4461, 4035, 306, 1450, 2670, 3650, 72, 4122}, {4139, 1669, 287, 1510, 1514, 1743, 2228, 3596}, {3867, 4461, 4035, 306, 1450, 2670, 3650, 72}, {4122, 4139, 1669, 287, 1510, 1514, 1743, 2228}, {3596, 3867, 4461, 4035, 306, 1450, 2670, 3650}, {72, 4122, 4139, 1669, 287, 1510, 1514, 1743}, {1743, 4122, 4035, 1514, 72, 4461, 1510, 3650}, {3867, 287, 2670, 3596, 1669, 1450, 2228, 4139}, {306, 1743, 4122, 4035, 1514, 72, 4461, 1510}, {3650, 3867, 287, 2670, 3596, 1669, 1450, 2228}, {4139, 306, 1743, 4122, 4035, 1514, 72, 4461}, {1510, 3650, 3867, 287, 2670, 3596, 1669, 1450}, {1669, 1743, 4461, 2670, 4139, 1514, 3867, 1450}, {4122, 1510, 3596, 306, 72, 287, 2228, 4035}, {3650, 1669, 1743, 4461, 2670, 4139, 1514, 3867}, {1450, 4122, 1510, 3596, 306, 72, 287, 2228}, {4035, 3650, 1669, 1743, 4461, 2670, 4139, 1514}, {3867, 1450, 4122, 1510, 3596, 306, 72, 287}, {3650, 306, 3867, 1743, 287, 4122, 2670, 4035}, {3596, 1514, 1669, 72, 1450, 4461, 2228, 1510}, {4139, 3650, 306, 3867, 1743, 287, 4122, 2670}, {4035, 3596, 1514, 1669, 72, 1450, 4461, 2228}, {1510, 4139, 3650, 306, 3867, 1743, 287, 4122}, {2670, 4035, 3596, 1514, 1669, 72, 1450, 4461}, {4035, 4139, 3596, 3650, 1514, 306, 1669, 3867}, {72, 1743, 1450, 287, 4461, 4122, 2228, 2670}, {1510, 4035, 4139, 3596, 3650, 1514, 306, 1669}, {3867, 72, 1743, 1450, 287, 4461, 4122, 2228}, {2670, 1510, 4035, 4139, 3596, 3650, 1514, 306}, {1669, 3867, 72, 1743, 1450, 287, 4461, 4122}, {2048, 10349, 12441, 514, 27600, 11912, 2184, 10806}, {26052, 25666, 29542, 28800, 10778, 19057, 15902, 29421}, {31840, 2048, 10349, 12441, 514, 27600, 11912, 2184}, {10806, 26052, 25666, 29542, 28800, 10778, 19057, 15902}, {29421, 31840, 2048, 10349, 12441, 514, 27600, 11912}, {2184, 10806, 26052, 25666, 29542, 28800, 10778, 19057}, {514, 11912, 10806, 25666, 28800, 19057, 29421, 2048}, {12441, 27600, 2184, 26052, 29542, 10778, 15902, 31840}, {10349, 514, 11912, 10806, 25666, 28800, 19057, 29421}, {2048, 12441, 27600, 2184, 26052, 29542, 10778, 15902}, {31840, 10349, 514, 11912, 10806, 25666, 28800, 19057}, {29421, 2048, 12441, 27600, 2184, 26052, 29542, 10778}, {2184, 25666, 10778, 29421, 10349, 27600, 10806, 29542}, {19057, 31840, 12441, 11912, 26052, 28800, 15902, 2048}, {514, 2184, 25666, 10778, 29421, 10349, 27600, 10806}, {29542, 19057, 31840, 12441, 11912, 26052, 28800, 15902}, {2048, 514, 2184, 25666, 10778, 29421, 10349, 27600}, {10806, 29542, 19057, 31840, 12441, 11912, 26052, 28800}, {25666, 19057, 2048, 27600, 26052, 10778, 31840, 514}, {10806, 28800, 29421, 12441, 2184, 29542, 15902, 10349}, {11912, 25666, 19057, 2048, 27600, 26052, 10778, 31840}, {514, 10806, 28800, 29421, 12441, 2184, 29542, 15902}, {10349, 11912, 25666, 19057, 2048, 27600, 26052, 10778}, {31840, 514, 10806, 28800, 29421, 12441, 2184, 29542}, {10778, 2048, 11912, 29542, 29421, 514, 26052, 19057}, {10349, 2184, 28800, 31840, 27600, 25666, 15902, 12441}, {10806, 10778, 2048, 11912, 29542, 29421, 514, 26052}, {19057, 10349, 2184, 28800, 31840, 27600, 25666, 15902}, {12441, 10806, 10778, 2048, 11912, 29542, 29421, 514}, {26052, 19057, 10349, 2184, 28800, 31840, 27600, 25666}, {29421, 27600, 29542, 31840, 11912, 28800, 2048, 2184}, {10778, 10349, 10806, 19057, 12441, 26052, 15902, 514}, {25666, 29421, 27600, 29542, 31840, 11912, 28800, 2048}, {2184, 10778, 10349, 10806, 19057, 12441, 26052, 15902}, {514, 25666, 29421, 27600, 29542, 31840, 11912, 28800}, {2048, 2184, 10778, 10349, 10806, 19057, 12441, 26052}, {10349, 26052, 29421, 11912, 10778, 12441, 25666, 31840}, {2184, 19057, 514, 29542, 2048, 10806, 15902, 27600}, {28800, 10349, 26052, 29421, 11912, 10778, 12441, 25666}, {31840, 2184, 19057, 514, 29542, 2048, 10806, 15902}, {27600, 28800, 10349, 26052, 29421, 11912, 10778, 12441}, {25666, 31840, 2184, 19057, 514, 29542, 2048, 10806}, {27600, 10778, 514, 28800, 12441, 29542, 10349, 25666}, {2048, 26052, 31840, 10806, 29421, 2184, 15902, 11912}, {19057, 27600, 10778, 514, 28800, 12441, 29542, 10349}, {25666, 2048, 26052, 31840, 10806, 29421, 2184, 15902}, {11912, 19057, 27600, 10778, 514, 28800, 12441, 29542}, {10349, 25666, 2048, 26052, 31840, 10806, 29421, 2184}, {10806, 31840, 26052, 2048, 25666, 10349, 29542, 12441}, {28800, 514, 10778, 27600, 19057, 11912, 15902, 2184}, {29421, 10806, 31840, 26052, 2048, 25666, 10349, 29542}, {12441, 28800, 514, 10778, 27600, 19057, 11912, 15902}, {2184, 29421, 10806, 31840, 26052, 2048, 25666, 10349}, {29542, 12441, 28800, 514, 10778, 27600, 19057, 11912}, {29542, 514, 19057, 2184, 31840, 25666, 12441, 10778}, {11912, 29421, 26052, 10349, 28800, 27600, 15902, 10806}, {2048, 29542, 514, 19057, 2184, 31840, 25666, 12441}, {10778, 11912, 29421, 26052, 10349, 28800, 27600, 15902}, {10806, 2048, 29542, 514, 19057, 2184, 31840, 25666}, {12441, 10778, 11912, 29421, 26052, 10349, 28800, 27600}, {19057, 10806, 10349, 10778, 2184, 2048, 28800, 11912}, {31840, 29542, 27600, 29421, 25666, 514, 15902, 26052}, {12441, 19057, 10806, 10349, 10778, 2184, 2048, 28800}, {11912, 31840, 29542, 27600, 29421, 25666, 514, 15902}, {26052, 12441, 19057, 10806, 10349, 10778, 2184, 2048}, {28800, 11912, 31840, 29542, 27600, 29421, 25666, 514}, {31840, 28800, 2184, 10349, 19057, 26052, 514, 29421}, {29542, 11912, 2048, 10778, 10806, 12441, 15902, 25666}, {27600, 31840, 28800, 2184, 10349, 19057, 26052, 514}, {29421, 29542, 11912, 2048, 10778, 10806, 12441, 15902}, {25666, 27600, 31840, 28800, 2184, 10349, 19057, 26052}, {514, 29421, 29542, 11912, 2048, 10778, 10806, 12441}, {12441, 29421, 28800, 10806, 514, 31840, 10778, 26052}, {27600, 2048, 19057, 25666, 11912, 10349, 15902, 29542}, {2184, 12441, 29421, 28800, 10806, 514, 31840, 10778}, {26052, 27600, 2048, 19057, 25666, 11912, 10349, 15902}, {29542, 2184, 12441, 29421, 28800, 10806, 514, 31840}, {10778, 26052, 27600, 2048, 19057, 25666, 11912, 10349}, {11912, 12441, 31840, 19057, 29542, 10806, 27600, 10349}, {29421, 10778, 25666, 2184, 514, 2048, 15902, 28800}, {26052, 11912, 12441, 31840, 19057, 29542, 10806, 27600}, {10349, 29421, 10778, 25666, 2184, 514, 2048, 15902}, {28800, 26052, 11912, 12441, 31840, 19057, 29542, 10806}, {27600, 10349, 29421, 10778, 25666, 2184, 514, 2048}, {26052, 2184, 27600, 12441, 2048, 29421, 19057, 28800}, {25666, 10806, 11912, 514, 10349, 31840, 15902, 10778}, {29542, 26052, 2184, 27600, 12441, 2048, 29421, 19057}, {28800, 25666, 10806, 11912, 514, 10349, 31840, 15902}, {10778, 29542, 26052, 2184, 27600, 12441, 2048, 29421}, {19057, 28800, 25666, 10806, 11912, 514, 10349, 31840}, {28800, 29542, 25666, 26052, 10806, 2184, 11912, 27600}, {514, 12441, 10349, 2048, 31840, 29421, 15902, 19057}, {10778, 28800, 29542, 25666, 26052, 10806, 2184, 11912}, {27600, 514, 12441, 10349, 2048, 31840, 29421, 15902}, {19057, 10778, 28800, 29542, 25666, 26052, 10806, 2184}, {11912, 27600, 514, 12441, 10349, 2048, 31840, 29421}
};

int16x8_t twist768_inv_x2[192] = {
    {4122, 4461, 287, 1450, 1743, 72, 3867, 1669}, {306, 1514, 3650, 3596, 4139, 4035, 1510, 2670}, {2228, 4122, 4461, 287, 1450, 1743, 72, 3867}, {1669, 306, 1514, 3650, 3596, 4139, 4035, 1510}, {2670, 2228, 4122, 4461, 287, 1450, 1743, 72}, {3867, 1669, 306, 1514, 3650, 3596, 4139, 4035}, {4461, 1450, 72, 1669, 1514, 3596, 4035, 2670}, {4122, 287, 1743, 3867, 306, 3650, 4139, 1510}, {2228, 4461, 1450, 72, 1669, 1514, 3596, 4035}, {2670, 4122, 287, 1743, 3867, 306, 3650, 4139}, {1510, 2228, 4461, 1450, 72, 1669, 1514, 3596}, {4035, 2670, 4122, 287, 1743, 3867, 306, 3650}, {287, 72, 306, 3596, 1510, 4122, 1450, 3867}, {1514, 4139, 2670, 4461, 1743, 1669, 3650, 4035}, {2228, 287, 72, 306, 3596, 1510, 4122, 1450}, {3867, 1514, 4139, 2670, 4461, 1743, 1669, 3650}, {4035, 2228, 287, 72, 306, 3596, 1510, 4122}, {1450, 3867, 1514, 4139, 2670, 4461, 1743, 1669}, {1450, 1669, 3596, 2670, 287, 3867, 3650, 1510}, {4461, 72, 1514, 4035, 4122, 1743, 306, 4139}, {2228, 1450, 1669, 3596, 2670, 287, 3867, 3650}, {1510, 4461, 72, 1514, 4035, 4122, 1743, 306}, {4139, 2228, 1450, 1669, 3596, 2670, 287, 3867}, {3650, 1510, 4461, 72, 1514, 4035, 4122, 1743}, {1743, 1514, 1510, 287, 1669, 4139, 4122, 72}, {3650, 2670, 1450, 306, 4035, 4461, 3867, 3596}, {2228, 1743, 1514, 1510, 287, 1669, 4139, 4122}, {72, 3650, 2670, 1450, 306, 4035, 4461, 3867}, {3596, 2228, 1743, 1514, 1510, 287, 1669, 4139}, {4122, 72, 3650, 2670, 1450, 306, 4035, 4461}, {72, 3596, 4122, 3867, 4139, 4461, 1669, 4035}, {287, 306, 1510, 1450, 1514, 2670, 1743, 3650}, {2228, 72, 3596, 4122, 3867, 4139, 4461, 1669}, {4035, 287, 306, 1510, 1450, 1514, 2670, 1743}, {3650, 2228, 72, 3596, 4122, 3867, 4139, 4461}, {1669, 4035, 287, 306, 1510, 1450, 1514, 2670}, {3867, 4035, 1450, 3650, 4122, 1669, 1510, 1743}, {3596, 4461, 306, 2670, 72, 4139, 287, 1514}, {2228, 3867, 4035, 1450, 3650, 4122, 1669, 1510}, {1743, 3596, 4461, 306, 2670, 72, 4139, 287}, {1514, 2228, 3867, 4035, 1450, 3650, 4122, 1669}, {1510, 1743, 3596, 4461, 306, 2670, 72, 4139}, {1669, 2670, 3867, 1510, 72, 4035, 1743, 4139}, {1450, 3596, 287, 3650, 4461, 1514, 4122, 306}, {2228, 1669, 2670, 3867, 1510, 72, 4035, 1743}, {4139, 1450, 3596, 287, 3650, 4461, 1514, 4122}, {306, 2228, 1669, 2670, 3867, 1510, 72, 4035}, {1743, 4139, 1450, 3596, 287, 3650, 4461, 1514}, {306, 4122, 1514, 4461, 3650, 287, 3596, 1450}, {4139, 1743, 4035, 72, 1510, 3867, 2670, 1669}, {2228, 306, 4122, 1514, 4461, 3650, 287, 3596}, {1450, 4139, 1743, 4035, 72, 1510, 3867, 2670}, {1669, 2228, 306, 4122, 1514, 4461, 3650, 287}, {3596, 1450, 4139, 1743, 4035, 72, 1510, 3867}, {1514, 287, 4139, 72, 2670, 306, 4461, 3596}, {1743, 1510, 1669, 4122, 3650, 1450, 4035, 3867}, {2228, 1514, 287, 4139, 72, 2670, 306, 4461}, {3596, 1743, 1510, 1669, 4122, 3650, 1450, 4035}, {3867, 2228, 1514, 287, 4139, 72, 2670, 306}, {4461, 3596, 1743, 1510, 1669, 4122, 3650, 1450}, {3650, 1743, 2670, 1514, 1450, 1510, 306, 287}, {4035, 1669, 4461, 4139, 3867, 4122, 3596, 72}, {2228, 3650, 1743, 2670, 1514, 1450, 1510, 306}, {287, 4035, 1669, 4461, 4139, 3867, 4122, 3596}, {72, 2228, 3650, 1743, 2670, 1514, 1450, 1510}, {306, 287, 4035, 1669, 4461, 4139, 3867, 4122}, {3596, 3867, 4461, 4035, 306, 1450, 2670, 3650}, {72, 4122, 4139, 1669, 287, 1510, 1514, 1743}, {2228, 3596, 3867, 4461, 4035, 306, 1450, 2670}, {3650, 72, 4122, 4139, 1669, 287, 1510, 1514}, {1743, 2228, 3596, 3867, 4461, 4035, 306, 1450}, {2670, 3650, 72, 4122, 4139, 1669, 287, 1510}, {4139, 306, 1743, 4122, 4035, 1514, 72, 4461}, {1510, 3650, 3867, 287, 2670, 3596, 1669, 1450}, {2228, 4139, 306, 1743, 4122, 4035, 1514, 72}, {4461, 1510, 3650, 3867, 287, 2670, 3596, 1669}, {1450, 2228, 4139, 306, 1743, 4122, 4035, 1514}, {72, 4461, 1510, 3650, 3867, 287, 2670, 3596}, {4035, 3650, 1669, 1743, 4461, 2670, 4139, 1514}, {3867, 1450, 4122, 1510, 3596, 306, 72, 287}, {2228, 4035, 3650, 1669, 1743, 4461, 2670, 4139}, {1514, 3867, 1450, 4122, 1510, 3596, 306, 72}, {287, 2228, 4035, 3650, 1669, 1743, 4461, 2670}, {4139, 1514, 3867, 1450, 4122, 1510, 3596, 306}, {1510, 4139, 3650, 306, 3867, 1743, 287, 4122}, {2670, 4035, 3596, 1514, 1669, 72, 1450, 4461}, {2228, 1510, 4139, 3650, 306, 3867, 1743, 287}, {4122, 2670, 4035, 3596, 1514, 1669, 72, 1450}, {4461, 2228, 1510, 4139, 3650, 306, 3867, 1743}, {287, 4122, 2670, 4035, 3596, 1514, 1669, 72}, {2670, 1510, 4035, 4139, 3596, 3650, 1514, 306}, {1669, 3867, 72, 1743, 1450, 287, 4461, 4122}, {2228, 2670, 1510, 4035, 4139, 3596, 3650, 1514}, {306, 1669, 3867, 72, 1743, 1450, 287, 4461}, {4122, 2228, 2670, 1510, 4035, 4139, 3596, 3650}, {1514, 306, 1669, 3867, 72, 1743, 1450, 287}, {29421, 31840, 2048, 10349, 12441, 514, 27600, 11912}, {2184, 10806, 26052, 25666, 29542, 28800, 10778, 19057}, {15902, 29421, 31840, 2048, 10349, 12441, 514, 27600}, {11912, 2184, 10806, 26052, 25666, 29542, 28800, 10778}, {19057, 15902, 29421, 31840, 2048, 10349, 12441, 514}, {27600, 11912, 2184, 10806, 26052, 25666, 29542, 28800}, {31840, 10349, 514, 11912, 10806, 25666, 28800, 19057}, {29421, 2048, 12441, 27600, 2184, 26052, 29542, 10778}, {15902, 31840, 10349, 514, 11912, 10806, 25666, 28800}, {19057, 29421, 2048, 12441, 27600, 2184, 26052, 29542}, {10778, 15902, 31840, 10349, 514, 11912, 10806, 25666}, {28800, 19057, 29421, 2048, 12441, 27600, 2184, 26052}, {2048, 514, 2184, 25666, 10778, 29421, 10349, 27600}, {10806, 29542, 19057, 31840, 12441, 11912, 26052, 28800}, {15902, 2048, 514, 2184, 25666, 10778, 29421, 10349}, {27600, 10806, 29542, 19057, 31840, 12441, 11912, 26052}, {28800, 15902, 2048, 514, 2184, 25666, 10778, 29421}, {10349, 27600, 10806, 29542, 19057, 31840, 12441, 11912}, {10349, 11912, 25666, 19057, 2048, 27600, 26052, 10778}, {31840, 514, 10806, 28800, 29421, 12441, 2184, 29542}, {15902, 10349, 11912, 25666, 19057, 2048, 27600, 26052}, {10778, 31840, 514, 10806, 28800, 29421, 12441, 2184}, {29542, 15902, 10349, 11912, 25666, 19057, 2048, 27600}, {26052, 10778, 31840, 514, 10806, 28800, 29421, 12441}, {12441, 10806, 10778, 2048, 11912, 29542, 29421, 514}, {26052, 19057, 10349, 2184, 28800, 31840, 27600, 25666}, {15902, 12441, 10806, 10778, 2048, 11912, 29542, 29421}, {514, 26052, 19057, 10349, 2184, 28800, 31840, 27600}, {25666, 15902, 12441, 10806, 10778, 2048, 11912, 29542}, {29421, 514, 26052, 19057, 10349, 2184, 28800, 31840}, {514, 25666, 29421, 27600, 29542, 31840, 11912, 28800}, {2048, 2184, 10778, 10349, 10806, 19057, 12441, 26052}, {15902, 514, 25666, 29421, 27600, 29542, 31840, 11912}, {28800, 2048, 2184, 10778, 10349, 10806, 19057, 12441}, {26052, 15902, 514, 25666, 29421, 27600, 29542, 31840}, {11912, 28800, 2048, 2184, 10778, 10349, 10806, 19057}, {27600, 28800, 10349, 26052, 29421, 11912, 10778, 12441}, {25666, 31840, 2184, 19057, 514, 29542, 2048, 10806}, {15902, 27600, 28800, 10349, 26052, 29421, 11912, 10778}, {12441, 25666, 31840, 2184, 19057, 514, 29542, 2048}, {10806, 15902, 27600, 28800, 10349, 26052, 29421, 11912}, {10778, 12441, 25666, 31840, 2184, 19057, 514, 29542}, {11912, 19057, 27600, 10778, 514, 28800, 12441, 29542}, {10349, 25666, 2048, 26052, 31840, 10806, 29421, 2184}, {15902, 11912, 19057, 27600, 10778, 514, 28800, 12441}, {29542, 10349, 25666, 2048, 26052, 31840, 10806, 29421}, {2184, 15902, 11912, 19057, 27600, 10778, 514, 28800}, {12441, 29542, 10349, 25666, 2048, 26052, 31840, 10806}, {2184, 29421, 10806, 31840, 26052, 2048, 25666, 10349}, {29542, 12441, 28800, 514, 10778, 27600, 19057, 11912}, {15902, 2184, 29421, 10806, 31840, 26052, 2048, 25666}, {10349, 29542, 12441, 28800, 514, 10778, 27600, 19057}, {11912, 15902, 2184, 29421, 10806, 31840, 26052, 2048}, {25666, 10349, 29542, 12441, 28800, 514, 10778, 27600}, {10806, 2048, 29542, 514, 19057, 2184, 31840, 25666}, {12441, 10778, 11912, 29421, 26052, 10349, 28800, 27600}, {15902, 10806, 2048, 29542, 514, 19057, 2184, 31840}, {25666, 12441, 10778, 11912, 29421, 26052, 10349, 28800}, {27600, 15902, 10806, 2048, 29542, 514, 19057, 2184}, {31840, 25666, 12441, 10778, 11912, 29421, 26052, 10349}, {26052, 12441, 19057, 10806, 10349, 10778, 2184, 2048}, {28800, 11912, 31840, 29542, 27600, 29421, 25666, 514}, {15902, 26052, 12441, 19057, 10806, 10349, 10778, 2184}, {2048, 28800, 11912, 31840, 29542, 27600, 29421, 25666}, {514, 15902, 26052, 12441, 19057, 10806, 10349, 10778}, {2184, 2048, 28800, 11912, 31840, 29542, 27600, 29421}, {25666, 27600, 31840, 28800, 2184, 10349, 19057, 26052}, {514, 29421, 29542, 11912, 2048, 10778, 10806, 12441}, {15902, 25666, 27600, 31840, 28800, 2184, 10349, 19057}, {26052, 514, 29421, 29542, 11912, 2048, 10778, 10806}, {12441, 15902, 25666, 27600, 31840, 28800, 2184, 10349}, {19057, 26052, 514, 29421, 29542, 11912, 2048, 10778}, {29542, 2184, 12441, 29421, 28800, 10806, 514, 31840}, {10778, 26052, 27600, 2048, 19057, 25666, 11912, 10349}, {15902, 29542, 2184, 12441, 29421, 28800, 10806, 514}, {31840, 10778, 26052, 27600, 2048, 19057, 25666, 11912}, {10349, 15902, 29542, 2184, 12441, 29421, 28800, 10806}, {514, 31840, 10778, 26052, 27600, 2048, 19057, 25666}, {28800, 26052, 11912, 12441, 31840, 19057, 29542, 10806}, {27600, 10349, 29421, 10778, 25666, 2184, 514, 2048}, {15902, 28800, 26052, 11912, 12441, 31840, 19057, 29542}, {10806, 27600, 10349, 29421, 10778, 25666, 2184, 514}, {2048, 15902, 28800, 26052, 11912, 12441, 31840, 19057}, {29542, 10806, 27600, 10349, 29421, 10778, 25666, 2184}, {10778, 29542, 26052, 2184, 27600, 12441, 2048, 29421}, {19057, 28800, 25666, 10806, 11912, 514, 10349, 31840}, {15902, 10778, 29542, 26052, 2184, 27600, 12441, 2048}, {29421, 19057, 28800, 25666, 10806, 11912, 514, 10349}, {31840, 15902, 10778, 29542, 26052, 2184, 27600, 12441}, {2048, 29421, 19057, 28800, 25666, 10806, 11912, 514}, {19057, 10778, 28800, 29542, 25666, 26052, 10806, 2184}, {11912, 27600, 514, 12441, 10349, 2048, 31840, 29421}, {15902, 19057, 10778, 28800, 29542, 25666, 26052, 10806}, {2184, 11912, 27600, 514, 12441, 10349, 2048, 31840}, {29421, 15902, 19057, 10778, 28800, 29542, 25666, 26052}, {10806, 2184, 11912, 27600, 514, 12441, 10349, 2048}
};

void polymul_768x768_rader_in(int16x8_t* NTT_a, int16x8_t* NTT_b, int16x8_t* a, int16x8_t* b){
    int16x8_t a_out[96], b_out[96];
    // (x^768-1) -> (x^48-1)
    // truncated_rader-16
    for (int i=0; i<6; i++){
        __truncated_rader17_768(a_out+i, a+i, &twiddle_p_768, &twiddle_n_768, twist768+i);
        __truncated_rader17_768(b_out+i, b+i, &twiddle_p_768, &twiddle_n_768, twist768+i);
    }

    // reindex
    int16x8_t mask[3] = {0};
    int16_t m0[8] = {-1, 0, 0, -1, 0, 0, -1, 0};
    int16_t m1[8] = {0, -1, 0, 0, -1, 0, 0, -1};
    int16_t m2[8] = {0, 0, -1, 0, 0, -1, 0, 0};
    mask[0] = vld1q_s16(m0);
    mask[1] = vld1q_s16(m1);
    mask[2] = vld1q_s16(m2);

    //16_(x^48-1)
    int16x8_t A0[2], A1[2], A2[2], tmpa[6];
    int16x8_t B0[2], B1[2], B2[2], tmpb[6];
    for (int i=0; i<16; i++){
        //48 = 3x16
        for(int j = 0;j<2;j++){
            A0[j] = vorrq_s16(vorrq_s16(vandq_s16(a_out[i*6+j], mask[(0+j)%3]), vandq_s16(a_out[i*6+j+2], mask[(2+j)%3])), vandq_s16(a_out[i*6+j+4], mask[(1+j)%3]));
            A1[j] = vorrq_s16(vorrq_s16(vandq_s16(a_out[i*6+j], mask[(1+j)%3]), vandq_s16(a_out[i*6+j+2], mask[(0+j)%3])), vandq_s16(a_out[i*6+j+4], mask[(2+j)%3]));
            A2[j] = vorrq_s16(vorrq_s16(vandq_s16(a_out[i*6+j], mask[(2+j)%3]), vandq_s16(a_out[i*6+j+2], mask[(1+j)%3])), vandq_s16(a_out[i*6+j+4], mask[(0+j)%3]));

            B0[j] = vorrq_s16(vorrq_s16(vandq_s16(b_out[i*6+j], mask[(0+j)%3]), vandq_s16(b_out[i*6+j+2], mask[(2+j)%3])), vandq_s16(b_out[i*6+j+4], mask[(1+j)%3]));
            B1[j] = vorrq_s16(vorrq_s16(vandq_s16(b_out[i*6+j], mask[(1+j)%3]), vandq_s16(b_out[i*6+j+2], mask[(0+j)%3])), vandq_s16(b_out[i*6+j+4], mask[(2+j)%3]));
            B2[j] = vorrq_s16(vorrq_s16(vandq_s16(b_out[i*6+j], mask[(2+j)%3]), vandq_s16(b_out[i*6+j+2], mask[(1+j)%3])), vandq_s16(b_out[i*6+j+4], mask[(0+j)%3]));
        }

        //radix-3 (y^3-1) -> (y-1)*(y+311)*(y-310)
        for(int j = 0;j<2;j++){
            //a0' <- a0 + a1 +a2
            //a0[i] = barrett_fake(vaddq_s16(barrett_fake(vaddq_s16(A0[i], A1[i])), A2[i]));
            tmpa[j] = barrett_fake(vaddq_s16(vaddq_s16(A0[j], A1[j]), A2[j]));
            //a1' <- a0 - 311*a1 + 310*a2
            tmpa[j+2] = barrett_mls_311(barrett_mla_310(A0[j], A2[j]), A1[j]);
            //a2' <- a0 + 310*a1 - 311*a2
            tmpa[j+4] = barrett_mls_311(barrett_mla_310(A0[j], A1[j]), A2[j]);
            //b0' <- b0 + b1 + b2
            //b0[i] = barrett_fake(vaddq_s16(barrett_fake(vaddq_s16(B0[i], B1[i])), B2[i]));
            tmpb[j] = barrett_fake(vaddq_s16(vaddq_s16(B0[j], B1[j]), B2[j]));
            //b1' <- b0 - 311*b1 + 310*b2
            tmpb[j+2] = barrett_mls_311(barrett_mla_310(B0[j], B2[j]), B1[j]);
            //b2' <- b0 + 310*b1 - 311*b2
            tmpb[j+4] = barrett_mls_311(barrett_mla_310(B0[j], B1[j]), B2[j]);
        }

        //3_(x^16-1) -> CT
        for (int j=0; j<3; j++){
            NTT_a[i*3+j] = barrett_fake(vaddq_s16(tmpa[2*j], tmpa[2*j+1]));   
            NTT_a[i*3+j+48] = barrett_fake(vsubq_s16(tmpa[2*j], tmpa[2*j+1]));

            NTT_b[i*3+j] = barrett_fake(vaddq_s16(tmpb[2*j], tmpb[2*j+1]));
            NTT_b[i*3+j+48] = barrett_fake(vsubq_s16(tmpb[2*j], tmpb[2*j+1]));
        }
    }

    for (int i=0; i<12; i++){
        __transpose8_8x8(NTT_a+(i*8));
        __transpose8_8x8(NTT_b+(i*8));
    }
}

void polymul_768x768_rader_16x16(int16x8_t* c, int16x8_t* a, int16x8_t* b){       
    for(int i = 0;i<6;i++){
        __rader8x8p(c+8*i, a+8*i, b+8*i);
        __rader8x8n(c+8*i+48, a+8*i+48, b+8*i+48);
    }
}

void polymul_768x768_rader_16x16_x2(int16x8_t* c, int16x8_t* a, int16x8_t* b){       
    for(int i = 0;i<6;i++){
        __rader8x8p_x2(c+8*i, a+8*i, b+8*i);
        __rader8x8n_x2(c+8*i+48, a+8*i+48, b+8*i+48);
    }
}

void polymul_768x768_rader_out(int16x8_t* c, int16x8_t* c_in){
    int16x8_t NTT_c[96];
    
    for (int i=0; i<12; i++){
        __transpose8_8x8(c_in+(i*8));
    }
    
    // ict in[0-48]: (x^8-1), [48-96]: (x^8+1)
    for(int i = 0;i<48;i++){
        NTT_c[2*i]   = vaddq_s16(c_in[i], c_in[i+48]);
        NTT_c[2*i+1] = vsubq_s16(c_in[i], c_in[i+48]);
    }
    
    //Inv GT3x2
    int16x8_t mask[3] = {0};
    int16_t m0[8] = {-1, 0, 0, -1, 0, 0, -1, 0};
    int16_t m1[8] = {0, -1, 0, 0, -1, 0, 0, -1};
    int16_t m2[8] = {0, 0, -1, 0, 0, -1, 0, 0};
    mask[0] = vld1q_s16(m0);
    mask[1] = vld1q_s16(m1);
    mask[2] = vld1q_s16(m2);

    int16x8_t c0[2], c1[2], c2[2], tmpc[96];
    for (int i=0; i<16; i++){
        for(int j = 0;j<2;j++){
            //c0 <- 3061x(c0'+c1'+c2')
            c0[j] = innerProduct_3061(vaddq_s16(NTT_c[i*6+j], vaddq_s16(NTT_c[i*6+j+2], NTT_c[i*6+j+4])));
            //c1 <- 3061 x c0' + 3164 x c1' + 2957 x c2'
            c1[j] = barrett_mla_2957(barrett_mla_3164(innerProduct_3061(NTT_c[i*6+j]), NTT_c[i*6+j+2]), NTT_c[i*6+j+4]);
            //c2 <- 3061 x c0' + 2957 x c1' + 3164 x c2
            c2[j] = barrett_mla_2957(barrett_mla_3164(innerProduct_3061(NTT_c[i*6+j]), NTT_c[i*6+j+4]), NTT_c[i*6+j+2]);
        }

        //permute
        for(int j = 0;j<2;j++){
            tmpc[i*6+j  ] = vorrq_s16(vorrq_s16(vandq_s16(c0[j], mask[(0+j)%3]), vandq_s16(c1[j], mask[(1+j)%3])), vandq_s16(c2[j], mask[(2+j)%3]));
            tmpc[i*6+j+2] = vorrq_s16(vorrq_s16(vandq_s16(c0[j], mask[(2+j)%3]), vandq_s16(c1[j], mask[(0+j)%3])), vandq_s16(c2[j], mask[(1+j)%3]));
            tmpc[i*6+j+4] = vorrq_s16(vorrq_s16(vandq_s16(c0[j], mask[(1+j)%3]), vandq_s16(c1[j], mask[(2+j)%3])), vandq_s16(c2[j], mask[(0+j)%3]));
        }
    }

    //Rader17_inv
    for (int i=0; i<6; i++){
        __itruncated_rader_17_768(c+i, tmpc+i, &itwiddle_p_768, &itwiddle_n_768, twist768_inv+i);
    }
}

void polymul_768x768_rader_out_x2(int16x8_t* c, int16x8_t* c_in){
    int16x8_t NTT_c[96];
    
    for (int i=0; i<12; i++){
        __transpose8_8x8(c_in+(i*8));
    }
    
    // ict in[0-48]: (x^8-1), [48-96]: (x^8+1)
    for(int i = 0;i<48;i++){
        NTT_c[2*i]   = vaddq_s16(c_in[i], c_in[i+48]);
        NTT_c[2*i+1] = vsubq_s16(c_in[i], c_in[i+48]);
    }
    
    //Inv GT3x2
    int16x8_t mask[3] = {0};
    int16_t m0[8] = {-1, 0, 0, -1, 0, 0, -1, 0};
    int16_t m1[8] = {0, -1, 0, 0, -1, 0, 0, -1};
    int16_t m2[8] = {0, 0, -1, 0, 0, -1, 0, 0};
    mask[0] = vld1q_s16(m0);
    mask[1] = vld1q_s16(m1);
    mask[2] = vld1q_s16(m2);

    int16x8_t c0[2], c1[2], c2[2], tmpc[96];
    for (int i=0; i<16; i++){
        for(int j = 0;j<2;j++){
            //c0 <- 3061x(c0'+c1'+c2')
            c0[j] = innerProduct_3061(vaddq_s16(NTT_c[i*6+j], vaddq_s16(NTT_c[i*6+j+2], NTT_c[i*6+j+4])));
            //c1 <- 3061 x c0' + 3164 x c1' + 2957 x c2'
            c1[j] = barrett_mla_2957(barrett_mla_3164(innerProduct_3061(NTT_c[i*6+j]), NTT_c[i*6+j+2]), NTT_c[i*6+j+4]);
            //c2 <- 3061 x c0' + 2957 x c1' + 3164 x c2
            c2[j] = barrett_mla_2957(barrett_mla_3164(innerProduct_3061(NTT_c[i*6+j]), NTT_c[i*6+j+4]), NTT_c[i*6+j+2]);
        }

        //permute
        for(int j = 0;j<2;j++){
            tmpc[i*6+j  ] = vorrq_s16(vorrq_s16(vandq_s16(c0[j], mask[(0+j)%3]), vandq_s16(c1[j], mask[(1+j)%3])), vandq_s16(c2[j], mask[(2+j)%3]));
            tmpc[i*6+j+2] = vorrq_s16(vorrq_s16(vandq_s16(c0[j], mask[(2+j)%3]), vandq_s16(c1[j], mask[(0+j)%3])), vandq_s16(c2[j], mask[(1+j)%3]));
            tmpc[i*6+j+4] = vorrq_s16(vorrq_s16(vandq_s16(c0[j], mask[(1+j)%3]), vandq_s16(c1[j], mask[(2+j)%3])), vandq_s16(c2[j], mask[(0+j)%3]));
        }
    }

    //Rader17_inv
    for (int i=0; i<4; i++){
        __itruncated_rader_17_768(c+i, tmpc+i+2, &itwiddle_p_768, &itwiddle_n_768, twist768_inv_x2+i);
    }
    __itruncated_rader_17_768(c+4, tmpc, &itwiddle_p_768, &itwiddle_n_768, twist768_inv_x2+4);
    __itruncated_rader_17_768(c+5, tmpc+1, &itwiddle_p_768, &itwiddle_n_768, twist768_inv_x2+5);

}
